<!DOCTYPE html><html lang=en itemscope itemtype=http://schema.org/TechArticle><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=google-site-verification content=YaLDO6PjDQSpDh7kvHyEvOYPOc4rkERmW5VCftmVp6c><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1"><meta name=theme-color content=#FF9900><meta name=author itemprop=author content="Vitaliy Zasadnyy"><meta name=keywords itemprop=keywords content="unity3d, getsocial"><meta itemprop=image content=http://v.zasadnyy.com/img/seo/sharing-google-plus.png><meta name=twitter:card content=summary><meta name=twitter:site content=@zasadnyy><meta name=twitter:title content="Challenges in building Unity native plugins. Intro &#8226; Vitaliy Zasadnyy"><meta name=twitter:description content="Prehistory

Half a year ago GetSocial Mobile team had to prepare and release SDK v.3.0 with a lot of new cool features and breaking changes from 2...."><meta name=twitter:image:src content=http://v.zasadnyy.com/img/seo/sharing-twitter.png><meta property=og:title content="Challenges in building Unity native plugins. Intro &#8226; Vitaliy Zasadnyy"><meta property=og:site_name content="Vitaliy Zasadnyy"><meta property=og:type content=article><meta property=og:url content=http://v.zasadnyy.com/blog/challenges-in-building-unity-native-plugins-intro><meta property=og:description content="Prehistory

Half a year ago GetSocial Mobile team had to prepare and release SDK v.3.0 with a lot of new cool features and breaking changes from 2...."><meta property=og:image content=http://v.zasadnyy.com/img/seo/sharing-facebook.png><link rel=canonical itemprop=url href=http://v.zasadnyy.com/blog/challenges-in-building-unity-native-plugins-intro><link rel=alternate type=application/rss+xml title=RSS href=/feed.xml><title>Challenges in building Unity native plugins. Intro &#8226; Vitaliy Zasadnyy</title><link rel="shortcut icon" href=http://v.zasadnyy.com/img/favicons/favicon.ico><link rel=apple-touch-icon sizes=152x152 href=http://v.zasadnyy.com/img/favicons/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=144x144 href=http://v.zasadnyy.com/img/favicons/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=120x120 href=http://v.zasadnyy.com/img/favicons/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=114x114 href=http://v.zasadnyy.com/img/favicons/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=76x76 href=http://v.zasadnyy.com/img/favicons/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=72x72 href=http://v.zasadnyy.com/img/favicons/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=60x60 href=http://v.zasadnyy.com/img/favicons/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=57x57 href=http://v.zasadnyy.com/img/favicons/apple-touch-icon-57x57.png><link rel=icon type=image/png href=http://v.zasadnyy.com/img/favicons/favicon-196x196.png><link rel=icon type=image/png href=http://v.zasadnyy.com/img/favicons/favicon-160x160.png><link rel=icon type=image/png href=http://v.zasadnyy.com/img/favicons/favicon-96x96.png><link rel=icon type=image/png href=http://v.zasadnyy.com/img/favicons/favicon-32x32.png><link rel=icon type=image/png href=http://v.zasadnyy.com/img/favicons/favicon-16x16.png><meta name=msapplication-TileColor content=#2b5797><meta name=msapplication-TileImage content=http://v.zasadnyy.com/img/favicons/mstile-144x144.png><meta name=msapplication-config content=http://v.zasadnyy.com/img/favicons/browserconfig.xml><style type=text/css>.container-fluid:after,.container:after,.row:after{clear:both}.article-meta,.nav{text-transform:uppercase}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-size:10px;-webkit-tap-highlight-color:transparent}body{margin:0;background-color:#fff;font-family:Roboto,sans-serif;font-size:20px;font-weight:300;line-height:28px;color:#666;word-break:break-word;text-shadow:1px 1px 1px rgba(0,0,0,.004);text-rendering:optimizeLegibility!important;-webkit-font-smoothing:antialiased!important;-moz-osx-font-smoothing:grayscale!important}article,header,nav{display:block}.container-fluid:after,.container-fluid:before,.container:after,.container:before,.row:after,.row:before{content:" ";display:table}a{background-color:transparent;text-decoration:none;color:#F90;transition:color .2s ease-in-out}h1{margin:.67em 0;font-size:64px}h1,h3,ul{margin-bottom:10px}img{border:0;vertical-align:middle}*,:after,:before{box-sizing:border-box}p{margin:0 0 10px}.container,.container-fluid{padding-left:15px;padding-right:15px;margin-right:auto;margin-left:auto}ul{margin-top:0}@media (min-width:768px){.container{width:750px}}@media (min-width:992px){.container{width:970px}}@media (min-width:1200px){.container{width:1170px}}.row{margin-left:-15px;margin-right:-15px}.col-md-5,.col-md-7,.col-md-9,.col-xs-12{position:relative;min-height:1px;padding-left:15px;padding-right:15px}.col-xs-12{float:left;width:100%}@media (min-width:992px){.col-md-5,.col-md-7,.col-md-9{float:left}.col-md-5{width:41.6666666667%}.col-md-7{width:58.3333333333%}.col-md-9{width:75%}}h1,h3{font-family:inherit;line-height:1.1;color:inherit;margin-top:20px;font-weight:500;display:block;word-wrap:break-word}h3{font-size:48px}.header{padding:60px 50px 80px}.logo-header{display:inline-block;margin:0 60px}.logo-header img{margin:0 auto}@media (max-width:767px){body{font-size:16px;line-height:22.4px}h1{font-size:38.4px}h3{font-size:33.6px}.header{padding:40px 0 30px}.logo-header,.logo-header img{display:block}}.nav{display:inline-block;letter-spacing:2px}@media (max-width:767px){.nav{margin-top:15px;display:block;text-align:center}}.nav ul{padding:0}.nav li{display:inline-block;margin:0 12px}.nav .nav-link{padding:0 2px 8px;outline:0;font-size:16px;color:#666}.nav .nav-link.current{border-bottom:3px solid #F90}@media (max-width:767px){.nav li{line-height:220%}.nav .nav-link{padding-bottom:4px}}.article{float:none;line-height:1.6em}.article h3{margin:50px 0 14px;line-height:1.3em;font-size:1.6em;letter-spacing:-.5px}.article-header{margin-bottom:40px;padding:40px 0 50px;background:#333}.article-title{margin-bottom:10px;color:#fff}.article-description{color:#999}.article-meta{float:right;font-size:18px;z-index:1}@media (max-width:767px){.article-header{padding:20px 0 30px}.article-meta{float:left;font-size:16px}}.article-meta ul{margin:50px 0 30px 30px;padding:25px;background:#222}@media (max-width:991px){.article-meta ul{margin:0 auto 40px}}.article-meta li{margin-bottom:20px;list-style:none}.article-meta li:last-child{margin:0}.article-meta a{color:#fff}.article-meta .name{color:#999;display:block;line-height:100%}.article-meta .value{color:#fff;display:inline-block;line-height:100%}@font-face{font-family:Roboto;font-style:normal;font-weight:300;src:local('Roboto Light'),local('Roboto-Light'),url(http://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfaCWcynf_cDxXwCLxiixG1c.ttf)format('truetype')}@font-face{font-family:Roboto;font-style:normal;font-weight:500;src:local('Roboto Medium'),local('Roboto-Medium'),url(http://fonts.gstatic.com/s/roboto/v15/RxZJdnzeo3R5zSexge8UUaCWcynf_cDxXwCLxiixG1c.ttf)format('truetype')}</style><script>!function(e){function t(e,t,n){"use strict";function r(){for(var t,i=0;i<s.length;i++)s[i].href&&s[i].href.indexOf(e)>-1&&(t=!0);t?o.media=n||"all":setTimeout(r)}var o=window.document.createElement("link"),i=t||window.document.getElementsByTagName("script")[0],s=window.document.styleSheets;return o.rel="stylesheet",o.href=e,o.media="only x",i.parentNode.insertBefore(o,i),r(),o}for(var n in e)t(e[n])}(["/css/blog.css"]);</script><noscript><link rel="stylesheet" type="text/css" href="/css/blog.css"></noscript><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]--></head><body><div class=container><header class=header><a class=logo-header href="/"><img src=/img/logo.svg alt="Vitaliy Zasadnyy" height=100px width=102px></a><nav class=nav><ul><li><a class="nav-link current" href="/">Blog</a></li><li><a class=nav-link href="/slides/">Slides</a></li><li><a class=nav-link href="/projects/">Projects</a></li></ul></nav></header></div><div class="article-header container-fluid"><div class=container><h1 class=article-title itemprop=name>Challenges in building Unity native plugins. Intro</h1><div class=row><div class=col-md-7><p class=article-description itemprop=headline></p><meta name=description itemprop=description content="Prehistory

Half a year ago GetSocial Mobile team had to prepare and release SDK v.3.0 with a lot of new cool features and breaking changes from 2...."></div></div></div></div><div class=container><div class=row><div class="article-meta col-md-5 col-xs-12"><ul><li><span class=name>Date published:</span> <span class=value itemprop=datePublished content=" 2015-08-05 ">August 5, 2015</span></li><li><span class=name>Est. Read Time:</span> <span class=value>10 mins</span></li><li><span class=name>Share with:</span> <span class=value><a href=# onclick="return window.open(&quot;https://plus.google.com/share?url=http://v.zasadnyy.com/blog/challenges-in-building-unity-native-plugins-intro&quot;,&quot;newwindow&quot;,&quot;width=600, height=500&quot;),!1">Google+</a></span> <span>&#8226;</span> <span class=value><a href=# onclick="return window.open(&quot;https://twitter.com/home?status=http://v.zasadnyy.com/blog/challenges-in-building-unity-native-plugins-intro&quot;,&quot;newwindow&quot;,&quot;width=600, height=250&quot;),!1">Twitter</a></span> <span>&#8226;</span> <span class=value><a href=# onclick="return window.open(&quot;https://www.facebook.com/sharer/sharer.php?u=http://v.zasadnyy.com/blog/challenges-in-building-unity-native-plugins-intro&quot;,&quot;newwindow&quot;,&quot;width=600, height=500&quot;),!1">Facebook</a></span></li><li><span class=name>Tags:</span> <span class=value><a class=category href=/blog/tag/unity3d>#unity3d</a>, <a class=category href=/blog/tag/getsocial>#getsocial</a></span></li><li><span class=name>Originaly published at:</span> <span class=value><a href="https://www.getsocial.im/blog/challenges-in-building-unity-native-plugins/" target=_blank>The GetSocial Blog</a></span></li></ul></div><article class="article col-md-9" itemprop=articleBody><h3 id=prehistory>Prehistory</h3><p>Half a year ago GetSocial Mobile team had to prepare and release SDK v.3.0 with a lot of new cool features and breaking changes from 2.x version. Just in that time I’ve joined a company and had a chance to make a complete revamp of Unity SDK.Half a year ago GetSocial Mobile team released SDK v.3.0 with a lot of new cool features and breaking changes from 2.x version. Since then, I’ve joined GetSocial and have had an opportunity to make a complete revamp of their Unity SDK.</p><p>In this series of posts, I’ll describe what decisions we made and what challenges our team faced with developing the <a href=https://github.com/getsocial-im/getsocial-unity-sdk>GetSocial Unity SDK</a>.</p><h3 id=approaches-in-building-unity-sdk>Approaches in building Unity SDK</h3><p>First, we needed to decide which approach to go for in order to create an SDK.</p><p>At that moment, we had <a href=https://github.com/getsocial-im/getsocial-android-sdk>Android SDK</a> written in Java and <a href=https://github.com/getsocial-im/getsocial-ios-sdk>iOS SDK</a> in ObjectiveC, both completely native to achieve the best performance and user experience. Unity supports three scripting languages: C#, UnityScript (aka JavaScript), and Boo. We decided to expose API in C# as it’s <a href="http://blogs.unity3d.com/2014/09/03/documentation-unity-scripting-languages-and-you/">the most widely used one</a>.</p><p>Let’s check which options we had to achieve the goal…</p><h5 id=pure-c-sdk>Pure C# SDK</h5><p>The best approach from developer and user perspective as</p><ul><li>it delivers the best performance;</li><li>it is simple to setup;</li><li>we could make SDK available to 21 platforms supported by Unity.</li></ul><p>Looks like an ideal solution, but there are few huge disadvantages:</p><ul><li>at the end we’ll have a third huge codebase that should be kept in sync with iOS and Android ones;</li><li>all UI should be reimplemented in C# that is not the easiest task as all games use different UI frameworks.</li></ul><h5 id=cross-compilation-to-c>Cross-compilation to C#</h5><p>According Google <a href=http://gmailblog.blogspot.nl/2014/11/going-under-hood-of-inbox.html>report</a>, that they managed to reuse 70% of code between Android, iOS and Web Inbox clients, we were so impressed by the idea that decided to give it a try.</p><p>Because of similarity between Java and C# we digged in a direction of recompiling Android SDK to C#.</p><p>From a positive side, we found that:</p><ul><li>there are tools for cross-compilation like <a href="http://www.microsoft.com/en-us/download/details.aspx?id=14349">Java Language Conversion Assistant</a> from Microsoft;</li><li>in theory, in the end we get C# library, that is fast;</li><li>and possible to use on all Unity supported platforms.</li></ul><p>On the other hand:</p><ul><li>it’s not possible to cross-compile presentation layer as it uses Android APIs. That means we need to replicate UI part of the SDK manually on C#;</li><li>cross-compilation required a clear separation between business and presentation logic, which would lead to a huge refactoring in Android SDK;</li><li>it would be hard to establish automated C# SDK regenerations when Java source is updated, as cross-compilers produce <a href="https://msdn.microsoft.com/en-us/library/5atsz094(v=vs.71).aspx">upgrade issues</a> that should be fixed manually.</li></ul><h5 id=unity-native-plugin>Unity native plugin</h5><p>Native plugins are platform-specific native code libraries. They can access features like OS calls and third-party code libraries that would otherwise not be available to Unity.</p><p>Pros:</p><ul><li>very few code needed; a bridge is a thin adapter layer between API exposed in C# and native SDKs;</li><li>100% code reuse from native SDKs;</li><li>UI rendering is handled by native side =&gt; no problem with variety of Unity UI frameworks.</li></ul><p>Cons:</p><ul><li>we’d be able to deploy only to iOS and Android Unity games;</li><li>native SDKs API should be in sync to avoid huge amount of adapter’s code in a bridge;</li><li>Unity Java Native Interface implementation has issues (Unity engineers fix them quickly but tend to add a new one on each release).</li></ul><h3 id=selected-approach>Selected approach</h3><p>We decided to go with Unity native plugin approach as it required the least effort, gave plenty of advantages and flexibility. Now GetSocial Unity SDK has the following architecture: <img src=/img/posts/challenges-in-building-unity-native-plugins-intro-sdk-architecture.png alt="GetSocial Unity SDK Architecture"></p><p>Between C# API and native libraries, we have a bridge layer on Unity and native side. The main task for the bridge is to invoke methods between platforms and convert data to primitive types as we can’t pass objects between platforms.</p><p>To communicate between C# code and native side, Unity exposes a wide variety of APIs. On Android: Unity Messaging (the one we use to send messages between GameObjects) and wrappers around Java Native Interface. On iOS, we can invoke extern methods from ObjectiveC and use MonoPInvokeCallbackAttribute to call C# methods from the iOS world.</p><h3 id=everything-is-simple-right>Everything is simple, right?</h3><p>The theory is simple: thin bridge layer, few calls between C# and native platforms, nice demo app and problem solved. But a simple solution doesn’t come without any challenges. Here are a few of my favorites:</p><ul><li><strong>performance</strong>: potentially bridge could become a performance-wise bottleneck, especially if calls will be made on each frame (keep in mind <a href="https://www.youtube.com/watch?v=CaMTIgxCSqU">16ms rule</a>);</li><li><strong>testability</strong>: with Unity native plugin approach most of the SDK will be in the native code, that means we can test only on iOS or Android device/simulator, but not Unity player;</li><li><strong>continuous delivery</strong>: SDK consist of 3 parts, each one has it own build process, setting up build pipeline could be complicated;</li><li><strong>version fragmentation</strong>: Unity is a very dynamic platform, each release brings tons of cool features and … new bugs. Unlike game developers who can select Unity version and use it during whole game life, we have to support all Unity versions starting, at least, from 4.1.</li></ul><h3 id=want-to-know-more>Want to know more?</h3><p>It was only a first post from the series, follow GetSocial on social networks in order not to miss updates and don’t hesitate to share your thoughts and experience with building Unity plugins in comments.</p><hr>Share with: <span class=value><a href=# onclick="return window.open(&quot;https://plus.google.com/share?url=http://v.zasadnyy.com/blog/challenges-in-building-unity-native-plugins-intro&quot;,&quot;newwindow&quot;,&quot;width=600, height=500&quot;),!1">Google+</a></span> <span>&#8226;</span> <span class=value><a href=# onclick="return window.open(&quot;https://twitter.com/home?status=http://v.zasadnyy.com/blog/challenges-in-building-unity-native-plugins-intro&quot;,&quot;newwindow&quot;,&quot;width=600, height=250&quot;),!1">Twitter</a></span> <span>&#8226;</span> <span class=value><a href=# onclick="return window.open(&quot;https://www.facebook.com/sharer/sharer.php?u=http://v.zasadnyy.com/blog/challenges-in-building-unity-native-plugins-intro&quot;,&quot;newwindow&quot;,&quot;width=600, height=500&quot;),!1">Facebook</a></span></article><div class="post-switcher col-md-9"><div class=row><div class="switcher-item col-sm-6"></div><div class="switcher-item col-sm-6"><a class=text-right href=/blog/unity-issue-non-class-resources-are-not-copied-to-final-apk title="Unity issue: non-java resources are not included in final apk"><p class=switcher-content>Unity issue: non-java resources are not included in final apk</p><span class=arrow>→</span></a></div></div></div><div class="comments col-md-9"><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname="vzasadnyy";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="container-fluid footer-container"><footer class="footer container"><div class=row><div class="col-md-6 col-sm-7"><h4 class=hidden-xs>About</h4><div class="author-photo flow-img img-circle" style=background-image:url(/img/photo.jpg)></div><p class=author-about>Hi, my name is Vitaliy. My technical background includes mobile gaming, mobile application development, and large-scale enterprise systems. Nowadays, I'm leading the development of the next generation in-app marketing tools at <a href="https://www.getsocial.im/" target=_blank>GetSocial</a>. I'm a frequent speaker at conferences, an active member of various technical communities and a founder of the <a href="http://lviv.gdg.org.ua/" target=_blank>Google Developers Group Lviv</a>.</p></div><div class="get-in-touch col-md-4 col-sm-5 col-md-offset-1"><h4 class=hidden-xs>Get in touch</h4><p class=author-social>You can find me on <a href=https://www.google.com/+VitalikZasadnyy target=_blank>Google+</a>, <a href=http://twitter.com/zasadnyy target=_blank>Twitter</a> or <a href=https://www.linkedin.com/in/zasadnyy target=_blank>LinkedIn</a>. If you want reach me directly, please send an <a href=mailto:vitaliy@zasadnyy.com target=_blank>email</a>.</p><p class=subscribe>Subscribe with <a href=/feed.xml>RSS</a>.</p></div><div class=clearfix></div><div class="license text-center col-md-12"><i>Except as otherwise noted, the content of this page is licensed under the Creative Commons Attribution 3.0 License, and code samples are licensed under the Apache 2.0 License.</i></div></div></footer></div><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-35774352-2","auto"),ga("send","pageview");</script><script type=text/javascript>WebFontConfig={google:{families:["Roboto:500,300:latin"]}},function(){var t=document.createElement("script");t.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",t.type="text/javascript",t.async="true";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();</script></body></html>